<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content= "width=device-width, user-scalable=no">
	<meta name="referrer" content="no-referrer">
    <link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.cdnfonts.com/css/lovelo" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
	<script src="jquery.min.js"></script>
    <script src="https://cdn.zinggrid.com/zinggrid.min.js"></script>
    <script src="https://kit.fontawesome.com/0a7198e186.js" crossorigin="anonymous"></script>
    <link rel="shortcut icon" type="image/jpg" href="img/favicon2.png"/>
    <link rel="stylesheet" href="css/index.css">
    <title>Easy Approuch | Dashboard</title>
</head>
<body>
    <header>
        <h1>Bienvenido <span id="nombrecliente"></span></h1>
    </header>
   <zing-grid caption="Easy Marketing Leads" editor-controls="all" pager="" page-size="100" layout="row" role="grid" editor="inline" viewport="tablet-portrait">
    <zg-data src="https://presupuestaya-production.up.railway.app/api/leads/findAllByUsuarioIdAndFechaCreacionDesc/1?page=0&size=50"></zg-data>
  </zing-grid>
    <table id="datos" class="contenedor">
        <tbody>
            <tr>
                <td>ID</td>
                <td>Nombre</td>
                <td>Teléfono</td>
                <td>Email</td>
                <td>Whatsapp</td>
                <td>Llamada</td>
                <td>Email Enviado</td>
                <td>Estado del Lead</td>
                <td>Fecha de Creación</td>
                <td>Observaciones</td>
            </tr>
        </tbody>
    </table>
    

  
   
<footer>
    <ul>
        <li>Políticas de Empresa</li>
        <li>Preguntas Frecuentes</li>
        <li>Aviso Legal</li>
    </ul>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
    <script>
      
        // COLORES
        $(document).ready(
            function obtenerColores() {
    // Esto selecciona todos los estado.color que están dentro de un estado.color
    let cajas = document.querySelectorAll("[data-field-index='estado.color'] [data-field-index='estado.color']");
    let colores = [];
    for (let i = 0; i < cajas.length; i++) {
        colores.push(cajas[i].textContent);
    }

    return colores;
});


$(document).ready(function () {
    $.ajax({
        url: 'https://presupuestaya-production.up.railway.app/api/leads/findAllByUsuarioIdAndFechaCreacionDesc/1?page=0&size=50',
        type: 'GET',
        contentType: "application/json; charset=utf-8",
        async: false, // HERE
        
        success: function (response) {
            let leadsEmpresas = response;
            let template = '';
            leadsEmpresas.forEach(task => {
                template += `
                        <tbody class="lista" id="lista">
                            <tr class="persona">
                                <td>${task.id}</td>
                                <td>${task.nombre}</td>
                                <td>
                                    <a href="tel:${task.telefono}"><i class="fa-solid fa-phone"></i></a>
                                    <a href="wa.me/34:${task.telefono}"><i class="fa-brands fa-whatsapp"></i></a>
                                </td>
                                <td><a href="mailto:${task.email}"><i class="fa-regular fa-envelope"></i></a></td>
                                <td><input type="checkbox" data-whatsapp="${task.whatsapp}"></td>
                                <td><input type="checkbox" data-llamada="${task.llamada}"></td>  
                                <td><input type="checkbox" data-email="${task.emailEnviado}"></td> 
                                <td>
                                    <select name="" id="" value="${task.estadoNombre}">
                                        <option value="1">No Contactado</option>
                                        <option value="2">Contactado</option>
                                        <option value="3">Propuesta</option>
                                        <option value="4">Negociación</option>
                                        <option value="5">Cerrado</option>
                                    </select>
                                </td>
                                <td>${task.fechaCreacion}</td>
                                <td><input type="text" value="${task.observacion}"></td>  
                            </tr>
                        </tbody>
                `
            })

            let datos = document.getElementById('datos');
            datos.innerHTML += template;

            // Get all the input elements in the table
            var inputs = document.querySelectorAll('#datos input[type="checkbox"]');

            // Loop through each input element and check its data attribute
            inputs.forEach(function(input) {
            if (input.dataset.whatsapp === "true" || input.dataset.llamada === "true" || input.dataset.email === "true") {
                input.checked = true;
            }
            });

        }

    })


})
      
      </script>
</body>
</html>